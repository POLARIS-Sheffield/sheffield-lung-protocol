 <!DOCTYPE html>
 <html>
    <head>
        <link rel="shortcut icon" href="icons/merged.png">
        <link rel="stylesheet" href="styles.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <link href="https://cdn.jsdelivr.net/css-toggle-switch/latest/toggle-switch.css" rel="stylesheet" />

        <title>UoS-GEHC Lung Protocol</title>
    </head>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LEEGWJD49K"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-LEEGWJD49K');
    </script>

    <body onload="document.getElementById('defaultOpen').click();">
    <div id="page-container">
        <div id="content-wrap">
            <div class="header-img-left"></div>
            <h1 style="top:3em;" class="center">Sheffield-GEHC Lung Protocol</h1>
            <div class="header-img-right"></div>
        
            <!-- Search-Filter UI -->
            <div style="top:16em; width:25em;" class="center">
                <form>
                    <fieldset class="fieldset" style="text-align:center;"data-role="controlgroup" data-type="horizontal">
                        <input id= "b_1_5T" onclick="createTable()" name="state-d" type="radio" checked="" />
                        <label for="b_1_5T" onclick="createTable()">1.5T</label>
                        <input id= "b_3T"   onclick="createTable()" name="state-d" type="radio" />
                        <label for="b_3T"   onclick="createTable()">3T</label>
                        <input id="contrast" type="checkbox" onclick="filterTable()" checked>
                        <label for="contrast">DCE</label>
                        <input id="xenon" type="checkbox" onclick="filterTable()" checked>
                        <label for="xenon"><sup>129</sup>Xe</label>
                        <input id="download" type="button" onclick="downloadButton()" value="Download protocols">
                    </fieldset>
                    <input class="fieldset" type="text" id="myInput" onkeyup="searchTable()" placeholder="Search for sequence.." title="Type in a sequence">
                </form>
            </div>
            <!-- Tab links --> 
            <div style="position:absolute; width:100%; top:13em;">
                <!-- Switch this with Download?-->
                <div class="dropdown">
                    <button onclick="dropdownFunction()" class="dropbtn">Filter by Lung Condition</button>
                    <div id="myDropdown" class="dropdown-content">
                    <a id="defaultOpen" class="tablinks active" onclick="openTab(event, 'SEQtab')">All sequences</a>
                    <a class="tablinks" onclick="openTab(event, 'ILDtab')">Interstitial Lung Disease</a>
                    <a class="tablinks" onclick="openTab(event, 'CFtab')">Cystic Fibrosis</a>
                    <a class="tablinks" onclick="openTab(event, 'PAEDtab')">Paediatric</a>
                    <a class="tablinks" onclick="openTab(event, 'COPDtab')">Chronic Obstructive Pulmonary Disease</a>
                    <a class="tablinks" onclick="openTab(event, 'ASTHMAtab')">Asthma</a>
                    <!--<a class="tablinks" onclick="openTab(event, 'PVtab')">Pulmonary Vascular Diseases</a>-->
                    </div>
                </div>
            </div>

            <!-- Tab content -->
            <div id="table_container" style="position:relative; margin-left:1%;width:98%; top:21em;">

                <div id="SEQtab" class="tabcontent">
                    <h3>All sequences</h3>
                    <table class="myTable" id="SEQ">
                    </table>    
                </div>

                <div id="ILDtab" class="tabcontent">
                    <h3>Interstitial Lung Disease</h3>
                    <table class="myTable" id="ILD">
                    </table>
                </div>
            
                <div id="CFtab" class="tabcontent">
                    <h3>Cystic Fibrosis</h3>
                    <table class="myTable" id="CF">
                    </table>
                </div>

                <div id="PAEDtab" class="tabcontent">
                    <h3>Paediatric</h3>
                    <table class="myTable" id="PAED">
                    </table>
                </div>

                <div id="COPDtab" class="tabcontent">
                    <h3>COPD</h3>
                    <table class="myTable" id="COPD">
                    </table>
                </div>

                <div id="ASTHMAtab" class="tabcontent">
                    <h3>Asthma</h3>
                    <table class="myTable" id="ASTHMA">
                    </table>
                </div>

                <div id="PVtab" class="tabcontent">
                    <h3>Pulmonary Vascular Diseases</h3>
                    <table class="myTable" id="PV">
                    </table>    
                </div>
            </div>
        </div>
        </div>
         <script>
            function openTab(evt, diseaseName) {
                // Declare all variables
                var i, tabcontent, tablinks;

                // Get all elements with class="tabcontent" and hide them
                tabcontent = document.getElementsByClassName("tabcontent");
                for (i = 0; i < tabcontent.length; i++) {
                    tabcontent[i].style.display = "none";
                }

                // Get all elements with class="tablinks" and remove the class "active"
                tablinks = document.getElementsByClassName("tablinks");
                for (i = 0; i < tablinks.length; i++) {
                    tablinks[i].className = tablinks[i].className.replace(" active", "");
                }
                // Show the current tab, and add an "active" class to the button that opened the tab
                document.getElementById(diseaseName).style.display = "block";
                evt.currentTarget.className += " active";

                //Reset search field
                input = document.getElementById("myInput");
                input.value="";

                createTable();
            }

            // Make sequences

            var sequences_1_5T_Sequence = {
                0: ["Xe QA"],
                1: ["3-plane Localizer"],
                2: ["Xe FA Calibration"],
                3: ["Xe 3D Ventilation"],
                4: ["Xe 3D Diffusion"],
                5: ["Xe 3D Dissolved"],
                6: ["Xe 2D Ventilation"],                
                7: ["Coil Calibration"],
                8: ["3D SPGR (RV, FRC+bag, TLC)"],
                9: ["bSSFP (FIESTA) ax"],
                10: ["SSFSE (HASTE) cor"],
                11: ["Dynamic SPGR Imaging (for FD MRI)"],
                12: ["PROPELLER w/ navigator"],
                13: ["PROPELLER w/o navigator"],
                14: ["T1-mapping (Look-Locker)"],
                15: ["UTE"],
                16: ["Variable FA 3D SPGR"],
                17: ["DISCO perfusion prep"],
                18: ["DISCO perfusion DCE (1st&2nd pass)"],
                19: ["TRICKS perfusion DCE 1st pass"],
                20: ["SPGR perfusion delayed (2nd pass)"]
            }

            var sequences_3T_Sequence = {
                0: ["Xe QA"],
                1: ["3-plane Localizer"],
                2: ["Xe FA Calibration"],
                3: ["Xe 3D Ventilation"],
                4: ["Xe 3D Diffusion"],
                5: ["Xe 3D Dissolved"],
                6: ["Xe 2D Ventilation"],                
                7: ["Coil Calibration"],
                8: ["3D SPGR (RV, FRC+bag, TLC)"],
                9: ["bSSFP (FIESTA) ax"],
                10: ["SSFSE (HASTE) cor"],
                11: ["Dynamic SPGR Imaging (for FD MRI)"],
                12: ["PROPELLER w/ navigator"],
                13: ["PROPELLER w/o navigator"],
                14: ["T1-mapping (Look-Locker)"],
                15: ["UTE"],
                16: ["Variable FA 3D SPGR"],
                17: ["DISCO perfusion prep"],
                18: ["DISCO perfusion DCE (1st&2nd pass)"],
                19: ["TRICKS perfusion DCE 1st pass"],
                20: ["SPGR perfusion delayed (2nd pass)"]
            }

            var sequences_1_5T_Details = {
                0:  ["protocol_sequences/1p5T/Xe-QA.png"],
                1:  ["protocol_sequences/1p5T/3pl-loc.png"],
                2:  ["protocol_sequences/1p5T/Xe-FAC.png"],
                3:  ["protocol_sequences/1p5T/Xe-vent.png"],
                4:  ["protocol_sequences/1p5T/Xe-diff.png"],
                5:  ["protocol_sequences/1p5T/Xe-dissolved.png"],
                6:  ["protocol_sequences/1p5T/Xe-2Dvent.png"],
                7:  ["protocol_sequences/old/CalBH.png"],
                8:  ["protocol_sequences/1p5T/1H-SPGR.png"],
                9:  ["protocol_sequences/1p5T/1H-SSFPaxial.png"],
                10:  ["protocol_sequences/1p5T/1H-HASTE.png"],
                11:  ["protocol_sequences/1p5T/1H-FDMRI.png"],
                12:  ["protocol_sequences/1p5T/1H-propeller-withnav.png"],
                13:  ["protocol_sequences/1p5T/1H-propeller-withoutnav.png"],
                14:  ["protocol_sequences/1p5T/1H-LookLocker.png"],
                15:  ["protocol_sequences/1p5T/1H-UTE.png"],
                16:  ["protocol_sequences/1p5T/1H-noncontrastperfusion-VFA.png"],
                17:  ["protocol_sequences/1p5T/1H-perfusion-disco-prep.png"],
                18:  ["protocol_sequences/1p5T/1H-perfusion-disco-dyn.png"],
                19:  ["protocol_sequences/1p5T/1H-perfusion-1stpass-tricks.png"],
                20:  ["protocol_sequences/1p5T/1H-perfusion-2ndpass.png"]
            }

            //Unused
            var sequences_1_5T_DetailsText = {
                0:  ["Protocol 1.5T"],
                1:  ["Protocol 1.5T"],
                2:  ["Protocol 1.5T"],
                3:  ["Protocol 1.5T"],
                4:  ["Protocol 1.5T"],
                5:  ["Protocol 1.5T"],
                6:  ["Protocol 1.5T"],
                7:  ["Protocol 1.5T"],
                8:  ["Protocol 1.5T"],
                9:  ["Protocol 1.5T"],
                10: ["Protocol 1.5T"],
                11: ["Protocol 1.5T"],
                12: ["Protocol 1.5T"],
                13: ["Protocol 1.5T"],
                14: ["Protocol 1.5T"],
                15: ["Protocol 1.5T"],
                16: ["Protocol 1.5T"],
                17: ["Protocol 1.5T"],
                18: ["Protocol 1.5T"],
                19: ["Protocol 1.5T"],
                20: ["Protocol 1.5T"]
            }

            var sequences_1_5T_Images = {
                0: ["/XeQA.png"],
                1: ["/Localizer.png"],
                2: ["/XeFA.png"],
                3: ["/Xe3DVentilation.png"],
                4: ["/Xe3DDiffusion.png","/Xe3DDiffusion_ADC.png"],
                5: ["/Xe3DDissolved.png","/Xe3DDissolved_RBC.png","/Xe3DDissolved_RBC_TP.png"],
                6: ["/Xe2DVentilation.png"],
                7:  ["/Calibration.png"],
                8:  ["/3DSPGR_TLC.png","/3DSPGR_RV.png"],
                9:  ["/FIESTA.png"],
                10: ["/HASTE.png"],
                11:  ["/PREFUL.png"],
                12: ["/PROPELLER_nav.png"],
                13: ["/PROPELLER_nonav.png"],
                14:  ["/T1_mapping.png"],
                15:  ["/UTE.png"],
                16: ["/DCE_non_contrast.png"],
                17: ["/DCE.png","/DCE_map.png"],
                18: ["/DCE.png","/DCE_map.png"],
                19: ["/DCE.png","/DCE_map.png"],
                20: ["/DCE.png","/DCE_map.png"]
            }

            var sequences_3T_Details = {
                0:  ["protocol_sequences/3T/Xe-QA.png"],
                1:  ["protocol_sequences/3T/3pl-loc.png"],
                2:  ["protocol_sequences/3T/Xe-FAC.png"],
                3:  ["protocol_sequences/3T/Xe-vent.png"],
                4:  ["protocol_sequences/3T/Xe-diff.png"],
                5:  ["protocol_sequences/3T/Xe-dissolved.png"],
                6:  ["protocol_sequences/3T/Xe-2Dvent.png"],
                7:  ["protocol_sequences/3T/CalBH.png"],
                8:  ["protocol_sequences/3T/1H-SPGR.png"],
                9:  ["protocol_sequences/3T/1H-SSFPaxial.png"],
                10:  ["protocol_sequences/3T/1H-HASTE.png"],
                11:  ["protocol_sequences/3T/1H-FDMRI.png"],
                12:  ["protocol_sequences/3T/1H-propeller-withnav.png"],
                13:  ["protocol_sequences/3T/1H-propeller-withoutnav.png"],
                14:  ["protocol_sequences/3T/1H-LookLocker.png"],
                15:  ["protocol_sequences/3T/1H-UTE.png"],
                16:  ["protocol_sequences/3T/1H-noncontrastperfusion-VFA.png"],
                17:  ["protocol_sequences/3T/1H-perfusion-disco-prep.png"],
                18:  ["protocol_sequences/3T/1H-perfusion-disco-dyn.png"],
                19:  ["protocol_sequences/3T/1H-perfusion-1stpass-tricks.png"],
                20:  ["protocol_sequences/3T/1H-perfusion-2ndpass.png"]
            }

            var sequences_3T_DetailsText = {
                0:  ["Protocol 3T"],
                1:  ["Protocol 3T"],
                2:  ["Protocol 3T"],
                3:  ["Protocol 3T"],
                4:  ["Protocol 3T"],
                5:  ["Protocol 3T"],
                6:  ["Protocol 3T"],
                7:  ["Protocol 3T"],
                8:  ["Protocol 3T"],
                9:  ["Protocol 3T"],
                10: ["Protocol 3T"],
                11: ["Protocol 3T"],
                12: ["Protocol 3T"],
                13: ["Protocol 3T"],
                14: ["Protocol 3T"],
                15: ["Protocol 3T"],
                16: ["Protocol 3T"],
                17: ["Protocol 3T"],
                18: ["Protocol 3T"],
                19: ["Protocol 3T"],
                20: ["Protocol 3T"]
            }

            var sequences_3T_Images = {
                0: ["/XeQA.png"],
                1: ["/Localizer.png"],
                2: ["/XeFA.png"],
                3: ["/Xe3DVentilation.png"],
                4: ["/Xe3DDiffusion.png","/Xe3DDiffusion_ADC.png"],
                5: ["/Xe3DDissolved.png","/Xe3DDissolved_RBC.png","/Xe3DDissolved_RBC_TP.png"],
                6: ["/Xe2DVentilation.png"],
                7:  ["/Calibration.png"],
                8:  ["/3DSPGR_TLC.png","/3DSPGR_RV.png"],
                9:  ["/FIESTA.png"],
                10: ["/HASTE.png"],
                11:  ["/PREFUL.png"],
                12: ["/PROPELLER_nav.png"],
                13: ["/PROPELLER_nonav.png"],
                14:  ["/T1_mapping.png"],
                15:  ["/UTE.png"],
                16: ["/DCE_non_contrast.png"],
                17: ["/DCE.png","/DCE_map.png"],
                18: ["/DCE.png","/DCE_map.png"],
                19: ["/DCE.png","/DCE_map.png"],
                20: ["/DCE.png","/DCE_map.png"]
            }

            var sequences_Instructions = {
                0: ["<b>Xe QA<br>(Research sequence)</b><br><br> FID pulse-acquire sequence." + 
                "Run on a phantom to make a quality assessment before running <sup>129</sup>Xe sequences in vivo."],
                1: ["<b>Localizer</b><br><br> Breath-hold FIESTA scan with slices in the 3 anatomical planes for patient localization." +
                "<br><br> Set a large FOV to cover the whole chest."],                
                2: ["<b>Xe FA calibration<br>(Research sequence)</b><br><br> Bloch-Siegert phase shift based spectroscopic sequence" +
                " to calibrate the radiofrequency power for non-proton nuclei.<br><br>This sequence is run at the beginning of each" +
                " <sup>129</sup>Xe in vivo MRI session to calibrate the transmit gain on a patient specific basis.<br><br>" + 
                "Reference:<a target='_blank' href='https://doi.org/10.1002/nbm.1657'>Schulte, RF et al. " + 
                "Transmit gain calibration for nonproton MR using the Bloch-Siegert shift. NMR in Biomed 24(9), 1068—1072 (2011).</a>"],
                3: ["<b>Xe 3D SSFP Ventilation<br>(Research sequence)</b><br><br> High resolution 3D FIESTA sequence to generate" +
                " maps of lung ventilation.<br><br>Localized ventilation defects can be visualized, characteristic of obstructive" +
                " lung diseases.<br><br>References:<a target='_blank' href='https://doi.org/10.1002/mrm.25732'>Stewart, NJ " + 
                "et al.<br>Feasibility of human lung ventilation imaging using highly polarized naturally abundant xenon and optimized" +
                " three-dimensional steady-state free precession.<br>Magn Reson Med 74(2), 346—352 (2015).</a><br><br><a target='_blank'" +
                " href='http://dx.doi.org/10.1136/thoraxjnl-2016-208948'>Marshall, H et al.<br>Detection of early subclinical lung disease in" +
                " children with cystic fibrosis by lung ventilation imaging with hyperpolarised gas MRI.<br>Thorax 72(8), 760—762 (2017).</a>"],
                4: ["<b>Xe 3D DWI<br>(Research sequence)</b><br><br>3D multiple b-value diffusion-weighted SPGR sequence with arbitrary undersampling" +
                " and compressed sensing reconstruction for diffusion mapping in a single breath-hold.<br><br>The apparent diffusion coefficient (ADC)" +
                " and the mean diffusive length scale (LmD) from diffusion morphometry modelling are measures of gas diffusion in the airspaces, where" +
                " restrictions by tissue boundaries provide information about lung microstructure down to the alveolar level.<br><br>References:" + 
                "<a target='_blank' href='https://doi.org/10.1002/mrm.26960'>Chan HF et al.<br>3D diffusion-weighted 129Xe MRI for whole lung morphometry." +
                "<br>Magn Reson Med 79(6), 2986—2995 (2018).</a><br><br><a target='_blank' href='https://doi.org/10.1148/radiol.2019181714'>Chan HF et al." +
                "<br>Airway Microstructure in Idiopathic Pulmonary Fibrosis: Assessment at Hyperpolarized 3He Diffusion-weighted MRI.<br>Radiology 291, 223—229 (2019).</a>"],
                5: ["<b>Xe 3D Dissolved-Phase <sup>129</sup>Xe Gas-Exchange Imaging<br>(Research sequence)</b><br><br>IDEAL spectroscopic imaging" + 
                "sequence to detect the relative signals of <sup>129</sup>Xe dissolved in the lung tissue/plasma (TP) and red blood cells (RBC), " + 
                "relative to the gas phase <sup>129</sup>Xe in the alveoli.<br><br>Signal ratio maps (RBC/TP, TP/Gas, RBC/Gas) are sensitive to " + 
                "interstitial tissue thickening and impairment of gas exchange, characteristic of pulmonary disorders such as ILD/IPF.<br><br>" + 
                "Reference:<a target='_blank' href='https://doi.org/10.1002/mrm.28609'>Collier, GJ et al.<br>Dissolved 129Xe lung MRI with" + 
                "four-echo 3D radial spectroscopic imaging: Quantification of regional gas transfer in idiopathic pulmonary fibrosis.<br>Magn Reson Med" +
                " 85(5), 2622—2633 (2021).</a>"],
                6: ["<b>Xe 2D SPGR Ventilation<br>(Research sequence)</b><br><br> 2D SPGR sequence to generate maps of lung ventilation as per the " +
                "guidelines outlined by the <a target='_blank' href='https://www.129xectc.org/'>Xe Clinical Trials Consortium.</a><br><br>" +
                "Reference:<a target='_blank' href='https://onlinelibrary.wiley.com/doi/full/10.1002/mrm.28985'>Niedbalski, PJ et al.<br>" + 
                "Protocols for multi-site trials using hyperpolarized 129Xe MRI for imaging of ventilation, alveolar-airspace size, and gas" +
                " exchange: A position paper from the 129Xe MRI clinical trials consortium.<br>Magn Reson Med 86(6), 2966—86 (2021).</a>"],
                7: ["<b>Calibration scan</b><br><br> Allows for ASSET and PURE options in the protocol.<br><br>Acquire images during breathhold." +
                " For repeatibility, control the inhaled volume using a bag of air."], 
                8: ["<b>3D SPGR</b><br><br> The inherent T2* contrast allows for distinction of aerated lung tissue. <br><br>" +
                " Acquire in separate breathholds at inspiration and expiration to estimate the total lung capacity (TLC) and residual volume (RV)." +
                " <br><br>For repeatibility, control the inhaled volume using a bag of air during inspiration. <br><br>Reference:<a target='_blank' " +
                "href='https://doi.org/10.1097/01.rli.0000250735.92266.6b'>Swift, AJ et al.<br>Rapid lung volumetry using ultrafast dynamic magnetic " +
                "resonance imaging during forced vital capacity maneuver: correlation with spirometry.<br>Invest Radiol 42(1), 37—41 (2007).</a>"],
                9:  ["<b>FIESTA</b><br><br> Balanced steady state free precession sequence with inherent contrast is proportional to the ratio T2/T1," +
                " providing bright signal in mucus and blood.<br><br>Acquire images during breathhold. For repeatibility, control the inhaled volume " +
                "using a bag of air during inspiration.<br><br>Reference:<a target='_blank' href='https://doi.org/10.1148/radiol.12110990'>Rajaram S et" +
                " al.<br>Lung Morphology Assessment with Balanced Steady-State Free Precession MR Imaging Compared with CT.<br>Radiology 263(2) (2012).</a>"],
                10: ["<b>HASTE</b><br><br> Single-shot fast spin echo sequence with T2 weighting and good lung parenchyma contrast. Acquire images during breathhold." + 
                "<br><br>Reference:<a target='_blank' href='https://journals.lww.com/investigativeradiology/fulltext/2007/10000/assessment_of_morphological_mri_for_pulmonary.8.aspx'>" +
                "Puderbach, M et al.<br>Assessment of Morphological MRI for Pulmonary Changes in Cystic Fibrosis (CF) Patients: Comparison to Thin-Section CT and Chest X-ray.<br>" +
                "Invest Radiol 42(10), 715—24 (2007).</a>"],
                11: ["<b>Dynamic SPGR Imaging (Research post-processing required)</b><br><br> High-temporal resolution SPGR imaging can be combined with " + 
                "Fourier Decomposition-based postprocessing methods for contrast-free lung perfusion (Q) and ventilation (V) assessment.<br><br>If <sup>129</sup>Xe" +
                " imaging is used in the protocol, plan this sequence to match the <sup>129</sup>Xe planning for optimal comparison of derived ventilation images." +
                "<br><br>Reference:<a target='_blank' href='https://doi.org/10.1002/mrm.26893'>Voskrebenzev, A et al.<br>Feasibility of quantitative regional ventilation" +
                " and perfusion mapping with phase-resolved functional lung (PREFUL) MRI in healthy volunteers and COPD, CTEPH, and CF patients.<br>Magn Reson Med 79(4), 2306—2314 (2018).</a>"],
                12: ["<b>PROPELLER w/ nav</b><br><br> Radial-based structural high resolution T2 weighted imaging. Intense areas are linked to presence of mucus and" +
                " inflammation.<br><br> Set fat suppresion and respiratory trigger to expiration.<br><br>Reference:<a target='_blank' " +
                "href='https://doi.org/10.1007/s00330-015-3850-9'>Ciet, P et al.<br>Assessment of CF lung disease using motion corrected PROPELLER MRI: " +
                "a comparison with CT. European Radiology 26, 780—787 (2016).</a>"],
                13: ["<b>PROPELLER w/o nav</b><br><br> Radial-based structural high resolution T2 weighted imaging. Intense areas are linked to presence of mucus and" +
                " inflammation.<br><br> Set fat suppresion and respiratory trigger to expiration.<br><br>Reference:<a target='_blank' " +
                "href='https://doi.org/10.1007/s00330-015-3850-9'>Ciet, P et al.<br>Assessment of CF lung disease using motion corrected PROPELLER MRI: " +
                "a comparison with CT. European Radiology 26, 780—787 (2016).</a>"],
                14: ["<b>T1-mapping (Look-Locker) (Research sequence)</b><br><br> 2D IR-based GRE sequence wherein several images are acquired rapidly during " +
                "the recovery phase after an inversion pulse. T1 maps are then produced pixelwise from the dynamic image series.<br><br>This sequence can be used" +
                " as part of an oxygen-enhanced (OE) imaging protocol to study the difference in T1-shortening effect when breathing 100% O2 vs. room air in" + 
                " patients with gas exchange limitation.<br><br>Reference:<a target='_blank' href='https://doi.org/10.1002/mrm.28342'>Saunders, LC et al. " + 
                "Free breathing lung T1 mapping using image registration in patients with idiopathic pulmonary fibrosis. Magn Reson Med 84(6), 3088—3102 (2020).</a>"],
                15: ["<b>UTE (Research sequence) </b><br><br> High resolution proton density weighted imaging with retrospective gating.<br><br>" +
                " Acquire images during free-breathing, using the respiratory bellows where possible (otherwise use k0 / DC signal) for retrospective gating.<br><br>" +
                "Reference:<a target='_blank' href='https://doi.org/10.1002/mrm.24570'>Johnson, KM et al.<br>Optimized 3D ultrashort echo time pulmonary MRI.<br>Magn Reson Med 70(5), 1241—1250 (2013).</a>"],
                16: ["<b>Variable flip angle 3D SPGR.</b><br><br> The sequence is repeated 4 times with different flip angles (i.e., 2,4,10,30) to generate a baseline " +
                "T1 map before acquiring the DCE with contrast.<br><br>The flip angle is set manually modifying the CV <i>ia_rf1</i>.<br><br>Acquire images during " +
                "breathhold. For repeatibility, control the inhaled volume using a bag of air during inspiration."],
                17: ["<b>DCE Perfusion Imaging Prep (DISCO)</b><br><br> Prior to dynamic free-breathing DCE acquisition with DISCO (described below)," +
                " a breath-hold acquisition is performed to provide a reference image for registering free-breathing images to." + 
                " For repeatibility, control the inhaled volume using a bag of air during inspiration."],
                18: ["<b>DCE Perfusion Imaging (DISCO)</b><br><br> Dynamic DCE MRI acquisition using DIfferential subsampling with cartesian ordering (DISCO)" + 
                " (~1 volume/second) acquired during the administration of a gadolinium bolus. " + 
                "<br><br>Acquire images during free-breathing to obtain both 1st pass perfusion and 2nd pass (delayed enhancement) information. Alternatively," + 
                " if DISCO is not available, 1st and 2nd pass information can be acquired separately as described below.<br><br>Calculate contrast dose at " +
                "0.05mls/kg - inject at 4mls/s.<br><br>Reference:<a target='_blank' href='https://onlinelibrary.wiley.com/doi/full/10.1002/jmri.23602'>" + 
                "Saranathan, M et al.<br>DDIfferential subsampling with cartesian ordering (DISCO): A high spatio-temporal resolution "+ 
                "dixon imaging sequence for multiphasic contrast enhanced abdominal imaging.<br>JMRI 35(6), 1484—92 (2012).</a>"],                
                19: ["<b>Alt DCE Perfusion Imaging (1st pass)</b><br><br> Dynamic 3D GRE acquisition with TRICKS (~1 volume/second) acquired during the administration of a gadolinium " +
                "bolus provides 1st pass perfusion information.<br><br>Acquire " + 
                "images during breathhold to measure the “first-pass” of the bolus. For repeatibility, control the inhaled volume using a bag of air during inspiration.<br><br>" + 
                "Calculate contrast dose at 0.05mls/kg - inject at 4mls/s.<br><br>Reference:<a target='_blank' href='https://doi.org/10.1086%2F674882'>Swift, AJ et al.<br>Dynamic" +
                " Contrast-Enhanced Magnetic Resonance Imaging in Patients with Pulmonary Arterial Hypertension.<br>Pulmonary Circulation 4, 61—70 (2014).</a>"],
                20: ["<b>Alt DCE Perfusion Imaging (2nd pass)</b><br><br> Dynamic 3D SPGR acquisition ~1 volume / 2 sec acquired immediately after the 1st pass TRICKS " +
                "acquisition to monitor bolus wash-out.<br><br>Acquire images during free-breathing for up to 5 minutes." + 
                "<br><br>Reference:<a target='_blank' href='https://doi.org/10.1086%2F674882'>Swift, AJ et al.<br>Dynamic" +
                " Contrast-Enhanced Magnetic Resonance Imaging in Patients with Pulmonary Arterial Hypertension.<br>Pulmonary Circulation 4, 61—70 (2014).</a>"]
            }

            var sequences_Protocol = {
                0: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                1: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                2: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                3: ["SEQ","CF","PAED","COPD","ASTHMA"],
                4: ["SEQ","ILD","COPD","PV"],
                5: ["SEQ","ILD","COPD","PV"],
                6: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                7: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                8: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                9: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                10: ["SEQ","ILD","CF","COPD","ASTHMA","PV"],
                11: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                12: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                13: ["SEQ","ILD","CF","COPD","ASTHMA","PV"],
                14: ["SEQ","ILD","CF","COPD","ASTHMA","PV"],
                15: ["SEQ","ILD","CF","PAED","COPD","ASTHMA","PV"],
                16: ["SEQ","ILD","CF","COPD","ASTHMA","PV"],
                17: ["SEQ","ILD","COPD","PV"],
                18: ["SEQ","ILD","COPD","PV"],
                19: ["SEQ","ILD","COPD","PV"],
                20: ["SEQ","ILD","COPD","PV"]
            }

            var sequences_Type = {
                0: ["Xenon"],
                1: ["Proton"],
                2: ["Xenon"],
                3: ["Xenon"],
                4: ["Xenon"],
                5: ["Xenon"],
                6: ["Xenon"],
                7:  ["Proton"],
                8:  ["Proton"],
                9:  ["Proton"],
                10:  ["Proton"],
                11:  ["Proton"],
                12:  ["Proton"],
                13:  ["Proton"],
                14:  ["Proton"],
                15:  ["Proton"],
                16:  ["Proton"],
                17:  ["Proton","Contrast"],
                18:  ["Proton","Contrast"],
                19:  ["Proton","Contrast"],
                20:  ["Proton","Contrast"]
            }

            //Create table dynamically, just make sure all attributes have the same length.
            function createTable() {

                var list_rows;

                if( document.getElementById('b_1_5T').checked)
                {
                    sequence_name = "sequences_1_5T_"
                    list_rows = Object.keys(sequences_1_5T_Sequence); 
                }
                else if( document.getElementById('b_3T').checked)
                {
                    sequence_name = "sequences_3T_"
                    list_rows = Object.keys(sequences_3T_Sequence); 
                }

                var tabId=document.getElementsByClassName('active')[0].getAttribute('onclick').split(" ")[1].replace(/\W/g, '');
                var tableId = tabId.substring(0,tabId.length-3);
                document.getElementById(tableId).innerHTML = "";

                var attributes = ["Sequence","Images","Details"];

                const fragment = document.createDocumentFragment()
                //Header:
                const trheader= document.createElement('tr')
                trheader.setAttribute("class","header")
                
                if (window.innerWidth > 960) {
                    max_columns = attributes.length;
                }
                else{
                    max_columns = 1;
                }

                for (let column = 0; column<max_columns; column++){
                    const th = document.createElement('th')
                    th.textContent = attributes[column]
                    th.style.textAlign = "center";

                    trheader.appendChild(th)
                }

                fragment.appendChild(trheader)
                //Rows:
                for (let row = 0; row<list_rows.length; row++){ 
                    const tr = document.createElement('tr')
                    tr.setAttribute('id',"Row"+row);
                    tr.setAttribute('class',"Row"+row);

                    for (let column = 0; column<max_columns; column++){
                        const a = document.createElement('a')
                        const p = document.createElement('p')
                        const td = document.createElement('td')
                        td.setAttribute('onclick','openField(this,"'+tableId+'")');
                        td.style.textAlign = "center";

                        if(column==0)
                        {
                            if(max_columns==1)
                            {
                                td.setAttribute("width","100%");
                            }
                            else{
                                td.setAttribute("width","15%");
                            }
                            p.textContent = eval(sequence_name+ attributes[column]+"["+row+"]");
                            td.appendChild(p)
                        }
                        else{
                            if(column==1)
                            {
                                td.setAttribute("width","25%");
                            }
                            else if(column==2)
                            {
                                td.setAttribute("width","60%");
                            }

                            a.textContent = attributes[column];
                            a.setAttribute("class", "detailslink");

                            td.appendChild(a)
                        }
                        td.setAttribute("type",sequences_Type[row])
                        tr.appendChild(td)
                    }

                    fragment.appendChild(tr)
                }
                
                const footer= document.createElement('footer');
                footer.setAttribute("class","stikybottom");
                footer.id="footer";
                
                const p= document.createElement('p');
                p.textContent = "Contact: "
                const p2= document.createElement('p');
                p2.innerHTML = "&nbsp;&nbsp;| &nbsp;Webpage: &nbsp;"

                const a= document.createElement('a');
                a.textContent = "polaris@sheffield.ac.uk"
                a.href='mailto:polaris@sheffield.ac.uk'

                const a2= document.createElement('a');
                a2.textContent = "sheffield.ac.uk/polaris"
                a2.href='https://www.sheffield.ac.uk/polaris'                
                
                p.appendChild(a)
                p2.appendChild(a2)

                footer.appendChild(p)
                footer.appendChild(p2)

                fragment.appendChild(footer)

                document.getElementById(tableId).appendChild(fragment)

                filterTable();

            }

            /*Filter sequence by name*/
            function filterTable() {
                var tabId=document.getElementsByClassName('active')[0].getAttribute('onclick').split(" ")[1].replace(/\W/g, '');
                var tableId = tabId.substring(0,tabId.length-3);
                var table = document.getElementById(tableId);
                var tr = table.getElementsByTagName("tr");

                for (var i = 1; i < tr.length; i++) {
                    var td = tr[i].getElementsByTagName("td")[0];
                    if (td) {
                        if(sequences_Protocol[i-1].includes(tableId)){
                            
                            tr[i].style.display = "";

                            if (!document.getElementById('contrast').checked) {
                                if(sequences_Type[i-1].includes('Contrast'))
                                {
                                    tr[i].style.display = "none";
                                }
                            }

                            if (!document.getElementById('xenon').checked) {
                                if(sequences_Type[i-1].includes('Xenon'))
                                {
                                    tr[i].style.display = "none";
                                }
                            }
                        }
                        else
                        {
                            tr[i].style.display = "none";
                        }
                    }       
                }
            }

            function searchTable() {
                // Declare variables
                var input, filter, table, tr, td, i, txtValue;
                input = document.getElementById("myInput");
                filter = input.value.toUpperCase();

                var tabId=document.getElementsByClassName('active')[0].getAttribute('onclick').split(" ")[1].replace(/\W/g, '');
                var tableId = tabId.substring(0,tabId.length-3);
                table = document.getElementById(tableId);
                tr = table.getElementsByTagName("tr");

                // Loop through all table rows, and hide those who don't match the search query
                for (i = 0; i < tr.length; i++) 
                {
                    td = tr[i].getElementsByTagName("td")[0];
                    if (td) 
                    {
                        txtValue = td.textContent || td.innerText;

                        if (txtValue.toUpperCase().indexOf(filter) > -1) 
                        {
                            tr[i].style.display = "";
                        } else 
                        {
                            tr[i].style.display = "none";
                        }

                        if(sequences_Protocol[i-1].includes(tableId)){

                            if (!document.getElementById('contrast').checked) 
                            {
                                if(sequences_Type[i-1].includes('Contrast'))
                                {
                                    tr[i].style.display = "none";
                                }
                            }

                            if (!document.getElementById('xenon').checked) 
                            {
                                if(sequences_Type[i-1].includes('Xenon'))
                                {
                                    tr[i].style.display = "none";
                                }
                            }
                        }
                        else
                        {
                            tr[i].style.display = "none";
                        }
                    }
                }
            }

            function dropdownFunction() {
                 document.getElementById("myDropdown").classList.toggle("show");
             }

            function downloadButton() {
                if( document.getElementById('b_1_5T').checked)
                {
                    window.open("https://drive.google.com/drive/folders/1aS2TcIV8GmBWXbAGA6wQoNofA7uYzKbA?usp=sharing")
                }
                else if( document.getElementById('b_3T').checked)
                {
                    window.open("https://drive.google.com/drive/folders/1ckKd5jp4yTo2LhhaLeu9FJ2yMUUchxIT?usp=sharing")
                }
                
            }

            // Close the dropdown menu if the user clicks outside of it
            window.onclick = function(event) {
                if (!event.target.matches('.dropbtn')) {
                    var dropdowns = document.getElementsByClassName("dropdown-content");
                    var i;
                    for (i = 0; i < dropdowns.length; i++) 
                    {
                        var openDropdown = dropdowns[i];
                        if (openDropdown.classList.contains('show')) 
                        {
                            openDropdown.classList.remove('show');
                        }
                    }
                }
            }
            //openField reacts when a row in the table is clicked filling that row with the linked information
            function openField(element,tableId) {
                var attributes = ["Sequence","Images","Details"];
                var row = element.closest('tr').rowIndex-1;
                var column = element.closest('td').cellIndex-1;
               // var myWindow = window.open("", "", "width=200,height=100");
                var currTR = element.closest('tr');

               // This row is already open - close it
                currTR.style.backgroundColor = "";
                currTR.style.color = "";

                if(currTR.hasAttribute('id'))//Main tab
                {
                    row_string = currTR.getAttribute('id');
                    row_number = row_string.substring(3,row_string.length);
                }
                else{//Details tab don't have id
                    row_string=currTR.getAttribute('class');
                    row_number = row_string.substring(3,row_string.length-7);
                }

                if(currTR && currTR.nextSibling && currTR.nextSibling.classList.contains(row_string+'details'))//Delete details if clicking on main tab and it is already open
                {
                    var elements = document.getElementsByClassName(row_string+'details');
                    while(elements.length > 0){
                        elements[0].parentNode.removeChild(elements[0]);
                    }
                }
                else if(row_string.includes('details')) {//Delete details when clicking on a detail tab
                   var elements = document.getElementsByClassName(row_string);
                   document.getElementsByClassName("Row"+row_number)[0].setAttribute("style","background-color:white;");
                   document.getElementsByClassName("Row"+row_number)[0].setAttribute("style","color:black;");

                    while(elements.length > 0){
                        elements[0].parentNode.removeChild(elements[0]);
                    }
                }
                else//Create details tabs when clicking main tab
                {
                    currTR.style.backgroundColor = '#DACCEB';
                    currTR.style.color = 'black';
                    var newTR = document.createElement("tr");
                    newTR.style.backgroundColor = 'white';
                    newTR.style.color = 'black';

                    newTR.setAttribute('class',row_string+'details');//To identify the added rows

                    if (window.innerWidth > 960) {

                        //Add sequence definition
                        newTR.innerHTML = '<td style="background-color:black;color:white;" onclick="openField(this,'+"'"+tableId+"'"+')">'+sequences_Instructions[row_number]+'</td>';

                        if(tableId=="SEQ" || tableId=="PAED")//Only show healthy images in the general outlook
                        {
                            if(row_string.match(/\d+/)[0]=="1"||row_string.match(/\d+/)[0]=="7") //loc and coil calibration
                            {
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="8")
                            {
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid_single_small'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy TLC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RV</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    </div></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="17"||row_string.match(/\d+/)[0]=="18"||row_string.match(/\d+/)[0]=="19"||row_string.match(/\d+/)[0]=="20")//DCE maps
                            {

                                //TODO: Not available healthy images yet 
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'></td>";
                                /*newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy map</figcaption></figure>\
                                    </div></td>";*/
                            }
                            else if(row_string.match(/\d+/)[0]=="0"||row_string.match(/\d+/)[0]=="2")//XA QA || XA FA
                            {
                                newTR.innerHTML = newTR.innerHTML+"<td style='background-color:black;'> <div class='grid_single'><figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure></div></td>";
                            }                            
                            else if(row_string.match(/\d+/)[0]=="5")//Dissolved maps
                            {
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid_single_small'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC/TP</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    </div></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="4")//Diffusion maps
                            {
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy ADC</figcaption></figure>\
                                    </div></td>";
                            }
                            else{
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"50%\"><figcaption>Healthy</figcaption></figure></td>";
                            }
                        }
                        else{

                            //Multiple images for maps //"14","15"]
                            if(row_string.match(/\d+/)[0]=="1"||row_string.match(/\d+/)[0]=="7") //loc and coil calibration
                            {
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="8")//SPGR maps
                            {
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy TLC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" TLC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RV</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" RV</figcaption></figure>\
                                    </div></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="17"||row_string.match(/\d+/)[0]=="18"||row_string.match(/\d+/)[0]=="19"||row_string.match(/\d+/)[0]=="20")//DCE maps
                            {
                                //TODO: Not available healthy images yet 

                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" map</figcaption></figure>\
                                    </div></td>";
                                    /*                                <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy map</figcaption></figure>\*/
                            }
                            else if(row_string.match(/\d+/)[0]=="0"||row_string.match(/\d+/)[0]=="2")//XA QA || XA FA
                            {
                                newTR.innerHTML = newTR.innerHTML+"<td style='background-color:black;'> <div class='grid_single'><figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure></div></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="5")//Dissolved maps
                            {
                                var content = newTR.innerHTML+"<td style='background-color:black;'> <div class='grid'>";
                                if(tableId=="ILD")
                                {
                                    content = content+
                                        "<figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+"/IPF"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>IPF</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+"/IPF"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>IPF RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC/TP</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+"/IPF"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>IPF RBC/TP</figcaption></figure>";
                                }
                                else{
                                    content =  content+"<figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC/TP</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" RBC/TP</figcaption></figure>";
                                }
                                newTR.innerHTML = content + "</div></td>";;
                            }
                            else if(row_string.match(/\d+/)[0]=="4")//Diffusion maps
                            {
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy ADC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" ADC</figcaption></figure>\
                                    </div></td>";
                            }
                            else{
                                newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'><div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                    </div></td>";
                            }
                        }

                        //Add protocol info

                        newTR.innerHTML =  newTR.innerHTML+'<td><a target="_blank" href='+eval(sequence_name+attributes[2]+"["+row_number+"]")+'><img class="protocol" id="protocol_'+row_number+'" src='+ eval(sequence_name+attributes[2]+"["+row_number+"]")+" width=\"100%\"></a></td>";
                    }
                    else{//Smaller screens

                        //Add sequence definition
                        newTR.innerHTML = '<td colspan="3" style="background-color:black;color:white;" onclick="openField(this,'+"'"+tableId+"'"+')">'+sequences_Instructions[row_number]+'</td>';

                        var newTRmid = document.createElement("tr");
                        newTRmid.style.backgroundColor = '#DACCEB';
                        newTRmid.style.color = 'black';

                        newTRmid.setAttribute('class',row_string+'details');//To identify the added rows

                        content = "<td colspan='3' style='background-color:black;' onclick='openField(this,"+'"'+tableId+'"'+")'>";

                        if(tableId=="SEQ" || tableId=="PAED")//Only show healthy images in the general outlook or paeds
                        {
                            if(row_string.match(/\d+/)[0]=="1"||row_string.match(/\d+/)[0]=="7") //loc and coil calibration
                            {
                                content =  content +"</td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="8")
                            {
                                content =  content + "<div class='grid_single_small'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy TLC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RV</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    </div></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="17"||row_string.match(/\d+/)[0]=="18"||row_string.match(/\d+/)[0]=="19"||row_string.match(/\d+/)[0]=="20")//DCE maps
                            {

                                //TODO: Not available healthy images yet 
                                content =  content + "</td>";
                                /*newTR.innerHTML =  newTR.innerHTML+"<td style='background-color:black;'>\
                                    <div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy map</figcaption></figure>\
                                    </div></td>";*/
                            }
                            else if(row_string.match(/\d+/)[0]=="5")//Dissolved maps
                            {
                                content =  content + "<div class='grid_single_small'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC/TP</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/black.png' width=\"100%\" height=\"100%\"><figcaption></figcaption></figure>\
                                    </div></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="4")//Diffusion maps
                            {
                                content =  content + "<div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy ADC</figcaption></figure>\
                                    </div></td>";
                            }
                            else{
                                content =  content + "<img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"50%\"><figcaption>Healthy</figcaption></figure></td>";
                            }
                        }
                        else{

                            content = "<td colspan='3' style='background-color:black;' onclick='openField(this,"+'"'+tableId+'"'+")'>";

                            //Multiple images for maps //"14","15"]
                            if(row_string.match(/\d+/)[0]=="1"||row_string.match(/\d+/)[0]=="7") //loc and coil calibration
                            {
                                content =  content +"</td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="8")//SPGR maps
                            {
                                content =  content + "<div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy TLC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" TLC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RV</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" RV</figcaption></figure>\
                                    </div></td>";
                            }
                            else if(row_string.match(/\d+/)[0]=="17"||row_string.match(/\d+/)[0]=="18"||row_string.match(/\d+/)[0]=="19"||row_string.match(/\d+/)[0]=="20")//DCE maps
                            {
                                //TODO: Not available healthy images yet 

                                content =  content + "<div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" map</figcaption></figure>\
                                    </div></tr>";
                                    /*                                <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy map</figcaption></figure>\*/
                            }
                            else if(row_string.match(/\d+/)[0]=="5")//Dissolved maps
                            {
                                content =  content + "<div class='grid'>";
                                    if(tableId=="ILD")
                                    {
                                        content = content+
                                    "<figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+"/IPF"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>IPF</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+"/IPF"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>IPF RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC/TP</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+"/IPF"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>IPF RBC/TP</figcaption></figure>";
                                    }
                                    else{
                                        content =  content+"<figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" RBC</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy RBC/TP</figcaption></figure>\
                                        <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][2]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" RBC/TP</figcaption></figure>";
                        
                                    }
                                    content = content + "</div></tr>";;
                            }
                            else if(row_string.match(/\d+/)[0]=="4")//Diffusion maps
                            {
                                content =  content + "<div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][0]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy ADC</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"][1]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+" ADC</figcaption></figure>\
                                    </div></td>";
                            }
                            else{
                                content =  content + "<div class='grid'>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/Healthy"+eval(sequence_name+attributes[1]+"["+row_number+"]")+"' width=\"100%\" height=\"100%\"><figcaption>Healthy</figcaption></figure>\
                                    <figure><img class='class_image' id='image_"+row_number+"' src='images/"+tableId+eval(sequence_name+attributes[1]+"["+row_number+"]")+"' width=\"100%\" height=\"100%\"><figcaption>"+tableId+"</figcaption></figure>\
                                    </div></tr>";
                            }
                        }

                        newTRmid.innerHTML =  content;

                        //Add protocol info

                        var newTRlow = document.createElement("tr");
                        newTRlow.style.backgroundColor = '#DACCEB';
                        newTRlow.style.color = 'black';

                        newTRlow.setAttribute('class',row_string+'details');//To identify the added rows

                        newTRlow.innerHTML =  newTRlow.innerHTML+'<td colspan="3"><a href='+eval(sequence_name+attributes[2]+"["+row_number+"]")+'><img class="protocol" id="protocol_'+row_number+'" src='+ eval(sequence_name+attributes[2]+"["+row_number+"]")+" width=\"100%\"></a></td>";

                        currTR.parentNode.insertBefore(newTRlow, currTR.nextSibling);

                        currTR.parentNode.insertBefore(newTRmid, currTR.nextSibling);
                    }
                    currTR.parentNode.insertBefore(newTR, currTR.nextSibling);
                }
            }
        </script>
    </body>
 </html>
